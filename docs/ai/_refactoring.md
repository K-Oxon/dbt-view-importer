# リファクタリング戦略

このドキュメントは、プロジェクト全体のコードのリファクタリングに関する指針と戦略をまとめたものです。

## 1. 単一責任原則 (SRP)
- 各クラスや関数は、単一の責任のみを持つこと。特に肥大化しているメソッドを分割し、明確な責務に切り分ける。
- BigQueryクライアントとdatacatalog lineageクライアントは分離し、それぞれが特定のタスクのみを担当するようにする。

## 2. ネストの軽減と早期returnの徹底
- if文やfor文のネストを可能な限り避け、早期returnを積極的に活用する。
- どうしてもネストが必要な場合、その処理を個別の関数やクラスに分割する。

## 3. コマンド実装の可読性向上
- import_cmd.pyのリファクタリングを行い、処理の流れを分かりやすくする。
- 複雑なロジックはサブ関数または別モジュールに分割し、単一責任に従った設計を目指す。

## 4. ディレクトリとファイル構成の見直し
- src/bq2dbt/commands/内のファイル名から「_cmd」を排除し、シンプルで直感的な命名にする。
- 各モジュールの責務がディレクトリ構造で明確に分かれるように、全体の構成を再検討する。

## 5. DependencyResolverのシンプル化
- 現在のDependencyResolverは複雑なグラフ構築や循環参照検出を行っているが、これをシンプルな再帰的取得に変更する。
- datacatalog lineage clientで依存関係を取得後、事前に指定した深さまで再帰的にソースを取得する手法にする。

## 6. 拡張性の確保
- 依存関係解析の実装を抽象化し、将来的にdatacatalog lineage client以外の手法（例：SQL解析）にも対応できるようにする。
- インターフェースや抽象クラスを活用し、異なる実装を容易にプラグインできる設計とする。

## 7. コーディング規約の遵守
- すべての関数、クラス、メソッドに対して型ヒントとドキュメントを整備する（Googleスタイルのdocstring推奨）。
- プロジェクトの既存ルールと合わせ、一貫性のあるコーディングスタイルを維持する。

以上のガイドラインに沿って、コードベースの保守性、拡張性、および可読性を向上させるリファクタリングを実施していきます。 